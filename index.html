<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Kona‑Quali Rechner — Standalone</title>
  <style>
    :root{
      --brand:#E10600;
      --bg:#0b0b0b;
      --ink:#111;
      --text:#fff;
      --muted:rgba(255,255,255,.66);
      --ok:#10b981;
      --bad:#e11d48;
      color-scheme: dark;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);font:16px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif}
    .wrap{max-width:1100px;margin:0 auto;padding:24px}
    header{position:sticky;top:0;z-index:10;background:#000d;border-bottom:1px solid #ffffff1a}
    header .inner{display:flex;align-items:center;justify-content:space-between;height:64px;max-width:1100px;margin:0 auto;padding:0 16px}
    .mark{display:flex;align-items:center;gap:10px;font-weight:700;letter-spacing:-.02em}
    .dot{width:12px;height:12px;border-radius:50%;background:var(--brand)}
    .bar{width:20px;height:10px;background:var(--brand);margin-left:-6px}
    .chip{border:1px solid #ffffff1a;border-radius:10px;background:#00000050;padding:8px 10px}
    h1{margin:12px 0 0;font-size:28px}
    .grid{display:grid;gap:16px}
    @media (min-width:900px){.grid-3{grid-template-columns:1fr 2fr}}
    .card{background:#1118;border:1px solid #ffffff1a;border-radius:16px;padding:18px}
    .label{font-size:11px;text-transform:uppercase;letter-spacing:.14em;color:var(--muted);margin-bottom:6px}
    select,input{width:100%;padding:10px 12px;border-radius:10px;border:1px solid #ffffff1a;background:#0000;color:var(--text);font:inherit}
    .seg{display:inline-flex;border:1px solid #ffffff1a;border-radius:10px;overflow:hidden}
    .seg button{padding:8px 12px;background:#0000;border:0;color:var(--muted);cursor:pointer}
    .seg button.active{background:var(--brand);color:#fff}
    .kpi{padding:18px;border:1px solid #ffffff1a;border-radius:12px;background:#0006}
    .kpi .big{font-weight:800;font-size:40px;letter-spacing:-.02em}
    .status-item{border:1px solid #ffffff1a;border-radius:12px;padding:12px;background:repeating-linear-gradient(135deg,#ffffff12 0 10px,transparent 10px 20px)}
    .badge{font-size:11px;text-transform:uppercase;padding:4px 8px;border-radius:8px;border:1px solid}
    .badge.ok{color:#6ee7b7;border-color:#10b98166;background:#10b98122}
    .badge.bad{color:#fca5a5;border-color:#e11d4866;background:#e11d4822}
    .barwrap{height:10px;background:#ffffff14;border-radius:999px;overflow:hidden}
    .barfill{height:100%;background:linear-gradient(90deg,var(--brand),#ff6b6b);width:0%}
    table{width:100%;border-collapse:collapse;font-size:14px}
    thead th{background:#ffffff10;text-align:left;padding:10px}
    tbody td{padding:10px;border-top:1px solid #ffffff1a}
  </style>
</head>
<body>
  <header>
    <div class="inner">
      <div class="mark"><div class="dot"></div><div class="bar"></div><div>IRON<span style="color:var(--brand)">MAN</span> Kona‑Quali Rechner</div></div>
    </div>
    <div style="height:3px;background:linear-gradient(90deg,var(--brand),var(--brand) 45%,transparent)"></div>
  </header>

  <main class="wrap">
    <div class="grid grid-3">
      <section class="card">
        <div class="label">Geschlecht</div>
        <div class="seg" id="genderSeg">
          <button data-val="Männer" class="active">Männer</button>
          <button data-val="Frauen">Frauen</button>
        </div>

        <div style="height:12px"></div>
        <div class="label">Altersklasse</div>
        <select id="ageGroup"></select>

        <div style="height:12px"></div>
        <div class="label">Deine Ironman‑Zeit (hh:mm:ss)</div>
        <input id="timeInput" placeholder="11:30:00" value="11:30:00" inputmode="numeric">
      </section>

      <section class="grid" id="rightCol">
        <div class="kpi">
          <div class="label">Age‑Graded Time</div>
          <div class="big" id="kpiTime">00:00:00</div>
          <div class="label" id="kpiFactor">Faktor ×1.000</div>
        </div>

        <div class="card">
          <div class="label">Quali‑Schwellen</div>
          <div id="statusList" class="grid"></div>
        </div>

        <div class="card">
          <div class="label">Age‑Graded je Altersklasse</div>
          <div style="overflow:auto">
            <table>
              <thead><tr><th>AK</th><th>Zeit</th><th>Faktor</th></tr></thead>
              <tbody id="akTable"></tbody>
            </table>
          </div>
        </div>
      </section>
    </div>
  </main>

  <script>
    // ---- Data ----
    const AGE_GROUPS = ["18-24","25-29","30-34","35-39","40-44","45-49","50-54","55-59","60-64","65-69","70-74","75-79","80+"];
    const FACTORS = {
      "Männer":{"18-24":0.9698,"25-29":0.9921,"30-34":1.00,"35-39":0.9895,"40-44":0.9683,"45-49":0.9401,"50-54":0.9002,"55-59":0.8667,"60-64":0.8262,"65-69":0.7552,"70-74":0.6876,"75-79":0.6768,"80+":0.5555},
      "Frauen":{"18-24":0.8567,"25-29":0.8961,"30-34":0.8977,"35-39":0.985,"40-44":0.8707,"45-49":0.8501,"50-54":0.8125,"55-59":0.7778,"60-64":0.7218,"65-69":0.6828,"70-74":0.6439,"75-79":0.5521,"80+":0.5}
    };
    const RACES = [
      { name:"IRONMAN Switzerland 2025", thresholdSeconds:hmsToSeconds("09:03:00") },
      { name:"IRONMAN Sweden 2025",     thresholdSeconds:hmsToSeconds("08:57:00") },
      { name:"IRONMAN Wisconsin 2025",  thresholdSeconds:hmsToSeconds("09:27:00") },
      { name:"IRONMAN Wales 2025",  thresholdSeconds:hmsToSeconds("10:10:18") },
      { name:"IRONMAN Italy 2025",  thresholdSeconds:hmsToSeconds("08:42:30") },
      { name:"IRONMAN Copenhagen 2025",  thresholdSeconds:hmsToSeconds("08:41:07") },
      { name:"IRONMAN Tallin 2025",  thresholdSeconds:hmsToSeconds("08:56:34") },
      { name:"IRONMAN Japan 2025",  thresholdSeconds:hmsToSeconds("09:40:43") },
      { name:"IRONMAN Maryland 2025",  thresholdSeconds:hmsToSeconds("09:03:54") }
    ];

    // ---- Utils ----
    function hmsToSeconds(hms){
      const p = String(hms).split(":").map(x=>x.trim());
      let h=0,m=0,s=0;
      if (p.length===3){ h=+p[0]||0; m=+p[1]||0; s=+p[2]||0; }
      else if (p.length===2){ h=+p[0]||0; m=+p[1]||0; }
      else if (p.length===1){ h=+p[0]||0; }
      return Math.max(0,h)*3600 + Math.max(0,m)*60 + Math.max(0,s);
    }
    function secondsToHms(t){
      if (!isFinite(t) || t<=0) return "00:00:00";
      const h=Math.floor(t/3600), m=Math.floor((t%3600)/60), s=Math.round(t%60);
      const pad=n=>String(n).padStart(2,"0");
      return pad(h)+":"+pad(m)+":"+pad(s);
    }
    const clamp=(n,min,max)=>Math.max(min,Math.min(max,n));

    // ---- State ----
    let gender = "Männer";
    let ageGroup = "35-39";
    let timeStr = "11:30:00";

    // ---- DOM ----
    const seg = document.getElementById("genderSeg");
    seg.addEventListener("click", (e)=>{
      if(e.target.tagName!=="BUTTON") return;
      seg.querySelectorAll("button").forEach(b=>b.classList.remove("active"));
      e.target.classList.add("active");
      gender = e.target.getAttribute("data-val");
      render();
    });

    const ageSel = document.getElementById("ageGroup");
    AGE_GROUPS.forEach(ag=>{
      const opt = document.createElement("option");
      opt.value = ag; opt.textContent = ag;
      ageSel.appendChild(opt);
    });
    ageSel.value = ageGroup;
    ageSel.addEventListener("change", (e)=>{ ageGroup = e.target.value; render(); });

    const timeInput = document.getElementById("timeInput");
    timeInput.addEventListener("input", (e)=>{ timeStr = e.target.value; render(); });

    const kpiTime = document.getElementById("kpiTime");
    const kpiFactor = document.getElementById("kpiFactor");
    const statusList = document.getElementById("statusList");
    const akTable = document.getElementById("akTable");

    function render(){
      const inputSeconds = hmsToSeconds(timeStr);
      const factor = (FACTORS[gender] && FACTORS[gender][ageGroup]) || 1;
      const agSeconds = Math.round(inputSeconds * factor);

      kpiTime.textContent = secondsToHms(agSeconds);
      kpiFactor.textContent = "Faktor ×" + factor.toFixed(3);

      // Status cards
      statusList.innerHTML = "";
      RACES.forEach(r=>{
        const diff = agSeconds - r.thresholdSeconds;
        const qualifies = agSeconds <= r.thresholdSeconds;
        const ratio = clamp(agSeconds / r.thresholdSeconds, 0, 1.2);
        const pct = Math.round(ratio * 100);

        const item = document.createElement("div");
        item.className = "status-item";
        item.innerHTML = `
          <div style="display:flex;align-items:center;justify-content:space-between;gap:8px">
            <div style="font-weight:600">${r.name}</div>
            <span class="badge ${qualifies?"ok":"bad"}">${qualifies?"im Rahmen":"fehlend"}</span>
          </div>
          <div class="label">Grenze <span style="font-family:ui-monospace,Menlo,Consolas,monospace">${secondsToHms(r.thresholdSeconds)}</span></div>
          <div class="barwrap"><div class="barfill" style="width:${Math.min(100,pct)}%"></div></div>
          <div class="label" style="display:flex;justify-content:space-between">
            <span>Dein Wert: <span style="font-family:ui-monospace,Menlo,Consolas,monospace">${secondsToHms(agSeconds)}</span></span>
            <span>${qualifies?"Puffer":"Fehlen"} <span style="font-family:ui-monospace,Menlo,Consolas,monospace">${secondsToHms(Math.abs(diff))}</span></span>
          </div>
        `;
        statusList.appendChild(item);
      });

      // AK table
      akTable.innerHTML = "";
      AGE_GROUPS.forEach(ag=>{
        const f = (FACTORS[gender] && FACTORS[gender][ag]) || 1;
        const sec = Math.round(inputSeconds * f);
        const tr = document.createElement("tr");
        tr.innerHTML = `<td>${ag}</td>
          <td style="font-family:ui-monospace,Menlo,Consolas,monospace">${secondsToHms(sec)}</td>
          <td style="color:var(--muted)">×${f.toFixed(3)}</td>`;
        akTable.appendChild(tr);
      });
    }

    render();
  </script>
</body>
</html>